<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>TIME GLITCH GAME</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a0a;
            color: #fff;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
        }
        #game {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            overflow: hidden;
        }
        #player {
            width: 40px;
            height: 40px;
            background-color: #00ffcc;
            box-shadow: 0 0 15px #00ffcc;
            position: absolute;
            left: 100px;
            bottom: 30px;
            border-radius: 5px;
            transition: height 0.1s ease;
        }
        #world {
            position: absolute;
            height: 100%;
            width: 100000px;
            display: flex;
            align-items: flex-end;
            left: 0;
        }
        #platform {
            width: 100%;
            height: 30px;
            background: #111;
            box-shadow: 0 0 10px #ff00cc;
        }
        .obstacle, .questionBox {
            width: 30px;
            height: 50px;
            position: absolute;
            bottom: 30px;
            background-color: #ff0066;
            box-shadow: 0 0 10px #ff0066;
            border-radius: 3px;
        }
        .questionBox {
            background-color: #ffff00;
            color: #000;
            font-weight: bold;
            height: 30px;
            text-align: center;
            line-height: 30px;
        }
        #arrowPrompt {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
            display: none;
            z-index: 100;
        }
        #keyTimerBar {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 10px;
            background: #333;
            border: 1px solid #999;
            display: none;
            z-index: 900;
        }
        #keyTimerFill {
            width: 100%;
            height: 100%;
            background: #0ff;
            box-shadow: 0 0 5px #0ff;
        }
        #timer, #lives, #level {
            position: absolute;
            top: 10px;
            padding: 10px 15px;
            font-size: 18px;
            border: 1px solid #0ff;
            border-radius: 8px;
            background: rgba(0,255,255,0.1);
            box-shadow: 0 0 8px #0ff;
        }
        #timer { left: 10px; }
        #level { right: 140px; }
        #lives { right: 10px; }

        .menu {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #0a0a0a 0%, #1a1a2e 100%);
            z-index: 200;
            color: #0ff;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-shadow: 0 0 10px #0ff;
        }
        .menu.active {
            display: flex;
        }
        button {
            background-color: #0ff;
            color: #000;
            font-weight: bold;
            padding: 10px 20px;
            margin: 10px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 10px #0ff;
        }
        #messageOverlay {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0; left: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
            font-size: 24px;
        }
        #messageOverlay.active {
            display: flex;
        }
        #floatingMessage {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,255,255,0.1);
            padding: 10px 20px;
            border: 1px solid #0ff;
            border-radius: 8px;
            color: #0ff;
            font-size: 18px;
            display: none;
            z-index: 999;
        }
        .glitch {
            animation: glitch 0.5s linear;
        }
        @keyframes glitch {
            0% { transform: translate(0); opacity: 1; filter: hue-rotate(0deg); }
            20% { transform: translate(-5px, 5px) scale(1.01); filter: hue-rotate(30deg); opacity: 0.8; }
            40% { transform: translate(5px, -5px) scale(0.98); filter: hue-rotate(-30deg); opacity: 0.6; }
            60% { transform: translate(3px, 2px) scale(1.02); filter: hue-rotate(45deg); opacity: 0.8; }
            80% { transform: translate(-3px, -3px) scale(0.97); filter: hue-rotate(-45deg); opacity: 0.9; }
            100% { transform: translate(0); opacity: 1; filter: hue-rotate(0deg); }
        }
    </style>
</head>
<body>

<div id="mainMenu" class="menu active">
    <h1>TIME GLITCH</h1>
    <label for="colorPicker">Karakter Rengi:</label>
    <input type="color" id="colorPicker" value="#00ffcc">
    <button id="startBtn">Oyuna Başla</button>
</div>

<div id="pauseMenu" class="menu">
    <h2>Oyun Duraklatıldı</h2>
    <button id="resumeBtn">Devam Et</button>
    <button id="toggleMusicBtn">Müziği Kapat</button>
    <label for="volumeRange">Müzik Ses Seviyesi</label>
    <input type="range" id="volumeRange" min="0" max="1" step="0.05" value="0.5">
    <button id="backToMenuBtn">Ana Menüye Dön</button>
</div>

<div id="levelTransition" class="menu">
    <h2 id="levelTransitionText">Seviye Geçildi!</h2>
    <button id="nextLevelBtn">Diğer Seviyeye Geç</button>
</div>

<div id="game">
    <div id="player"></div>
    <div id="world"><div id="platform"></div></div>
    <div id="arrowPrompt"></div>
    <div id="keyTimerBar"><div id="keyTimerFill"></div></div>
    <div id="timer">Süre: <span id="timeLeft">0</span></div>
    <div id="lives">Can: <span id="livesCount">0</span></div>
    <div id="level">Seviye: <span id="levelNum">1</span></div>
    <div id="messageOverlay">
        <div id="messageText"></div>
        <button id="restartBtn">Tekrar Dene</button>
    </div>
    <div id="floatingMessage"></div>
</div>

<audio id="bgm" src="sounds/background.wav" loop></audio>

<script>
    const $ = id => document.getElementById(id);
    const player = $("player"), world = $("world"), game = $("game");
    const arrowPrompt = $("arrowPrompt"), timeDisplay = $("timeLeft");
    const livesDisplay = $("livesCount"), levelDisplay = $("levelNum");
    const overlay = $("messageOverlay"), messageText = $("messageText");
    const restartBtn = $("restartBtn"), keyBar = $("keyTimerBar");
    const keyFill = $("keyTimerFill"), floatingMessage = $("floatingMessage");
    const mainMenu = $("mainMenu"), startBtn = $("startBtn");
    const pauseMenu = $("pauseMenu"), resumeBtn = $("resumeBtn");
    const toggleMusicBtn = $("toggleMusicBtn"), volumeRange = $("volumeRange");
    const backToMenuBtn = $("backToMenuBtn");
    const levelTransition = $("levelTransition"), levelTransitionText = $("levelTransitionText");
    const nextLevelBtn = $("nextLevelBtn"), bgm = $("bgm");
    const colorPicker = $("colorPicker");

    let musicOn = true, isPaused = true, level = 1, time = 20, lives = 0;
    let timer, gameLoop, arrowInterval, spawnInterval;
    let playerY = 30, velocityY = 0, gravity = -0.6, jumpStrength = 10, isJumping = false;
    let worldOffset = 0, worldSpeed = 2;
    let keysToPress = [], arrows = ["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"];

    function applyCharacterColor() {
        const color = colorPicker.value;
        player.style.backgroundColor = color;
        player.style.boxShadow = `0 0 15px ${color}`;
    }

    startBtn.onclick = () => {
        mainMenu.classList.remove("active");
        applyCharacterColor();
        if (musicOn) bgm.play();
        startLevel();
    };

    resumeBtn.onclick = () => {
        pauseMenu.classList.remove("active");
        isPaused = false;
    };

    toggleMusicBtn.onclick = () => {
        musicOn = !musicOn;
        toggleMusicBtn.textContent = musicOn ? "Müziği Kapat" : "Müziği Aç";
        musicOn ? bgm.play() : bgm.pause();
    };

    volumeRange.oninput = () => {
        bgm.volume = volumeRange.value;
    };

    backToMenuBtn.onclick = () => {
        pauseMenu.classList.remove("active");
        mainMenu.classList.add("active");
        [timer, gameLoop, arrowInterval, spawnInterval].forEach(clearInterval);
        isPaused = true;
    };

    nextLevelBtn.onclick = () => {
        levelTransition.classList.remove("active");
        startLevel();
    };

    restartBtn.onclick = () => {
        overlay.classList.remove("active");
        startLevel();
    };

    document.addEventListener("keydown", e => {
        if (e.key === "Escape") {
            isPaused = true;
            pauseMenu.classList.add("active");
        }
        if (e.key.toLowerCase() === "w" && !isJumping && !isPaused) {
            velocityY = jumpStrength;
            isJumping = true;
        }
        if (e.key.toLowerCase() === "s" && !isPaused) {
            player.style.height = "20px";
        }
    });

    document.addEventListener("keyup", e => {
        if (e.key.toLowerCase() === "s") {
            player.style.height = "40px";
        }
    });

    function startLevel() {
        isPaused = true;
        time = 20 + (level - 1) * 10;
        timeDisplay.textContent = time;
        levelDisplay.textContent = level;
        worldOffset = 0; playerY = 30; velocityY = 0; isJumping = false;
        updatePlayerPosition(); applyCharacterColor();
        removeAll(".obstacle, .questionBox");
        startTimer(); scheduleArrowPrompts(); scheduleObstacles();
        startGameLoop(); overlay.classList.remove("active");
        setTimeout(() => isPaused = false, 1000);
    }

    function updatePlayerPosition() {
        player.style.bottom = playerY + "px";
    }

    function startGameLoop() {
        clearInterval(gameLoop);
        gameLoop = setInterval(() => {
            if (isPaused) return;
            worldOffset -= worldSpeed;
            world.style.left = worldOffset + "px";
            document.querySelectorAll(".obstacle, .questionBox").forEach(ob => {
                ob.style.left = (parseInt(ob.style.left) - worldSpeed) + "px";
                if (parseInt(ob.style.left) < -50) ob.remove();
            });
            velocityY += gravity;
            playerY += velocityY;
            if (playerY <= 30) { playerY = 30; velocityY = 0; isJumping = false; }
            updatePlayerPosition();
            checkCollisions();
        }, 16);
    }

    function startTimer() {
        clearInterval(timer);
        timer = setInterval(() => {
            if (!isPaused) {
                time--;
                timeDisplay.textContent = time;
                if (time <= 0) nextLevel();
            }
        }, 1000);
    }

    function scheduleArrowPrompts() {
        clearInterval(arrowInterval);
        arrowInterval = setInterval(() => {
            if (!isPaused) pauseGameForArrow();
        }, Math.max(4000 - level * 300, 1000));
    }

    function pauseGameForArrow() {
        if (
            pauseMenu.classList.contains("active") ||
            levelTransition.classList.contains("active") ||
            mainMenu.classList.contains("active")
        ) return;

        isPaused = true;
        keysToPress = [];
        for (let i = 0; i < Math.min(1 + Math.floor(level / 2), 3); i++) {
            keysToPress.push(arrows[Math.floor(Math.random() * arrows.length)]);
        }

        arrowPrompt.innerHTML = keysToPress.map(k => ({
            ArrowLeft: "⬅️", ArrowRight: "➡️", ArrowUp: "⬆️", ArrowDown: "⬇️"
        }[k])).join(" ");

        arrowPrompt.style.display = "block";
        keyBar.style.display = "block";
        keyFill.style.width = "100%";

        let elapsed = 0, duration = Math.max(3000 - level * 150, 1000);
        const countdown = setInterval(() => {
            elapsed += 50;
            keyFill.style.width = (100 - elapsed / duration * 100) + "%";
            if (elapsed >= duration) {
                clearInterval(countdown); handleArrowFail(); cleanup();
            }
        }, 50);

        let pressed = [];
        function onKeyDown(e) {
            if (!["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"].includes(e.key)) return;

            if (keysToPress.includes(e.key)) {
                pressed.push(e.key);
                if (pressed.length === keysToPress.length) {
                    isPaused = false;
                    cleanup();
                }
            } else {
                glitchEffect();
                setTimeout(() => { handleArrowFail(); cleanup(); }, 400);
            }
        }

        function cleanup() {
            document.removeEventListener("keydown", onKeyDown);
            arrowPrompt.style.display = "none";
            keyBar.style.display = "none";
            clearInterval(countdown);
        }

        document.addEventListener("keydown", onKeyDown);
    }

    function handleArrowFail() {
        isPaused = false;
        if (keysToPress.length === 1) loseLifeOrRestart();
        else {
            showMessage("Başarısız! Zamanda geri gittin.");
            level = Math.max(1, level - 1);
            setTimeout(startLevel, 2000);
        }
    }

    function glitchEffect() {
        game.classList.add("glitch");
        setTimeout(() => game.classList.remove("glitch"), 400);
    }

    function loseLifeOrRestart() {
        if (lives > 0) {
            lives--;
            livesDisplay.textContent = lives;
            showMessage("Bir can kaybettin! Devam...");
            setTimeout(startLevel, 2000);
        } else {
            showMessage("Oyun bitti.");
            isPaused = true;
            [timer, gameLoop, arrowInterval, spawnInterval].forEach(clearInterval);
        }
    }

    function nextLevel() {
        isPaused = true;
        level++;
        levelTransitionText.textContent = "Seviye " + (level - 1) + " tamamlandı!";
        levelTransition.classList.add("active");
    }

    function scheduleObstacles() {
        clearInterval(spawnInterval);
        spawnInterval = setInterval(() => {
            const ob = document.createElement("div");
            ob.style.left = (900 + Math.random() * 200) + "px";
            if (Math.random() < 0.85) ob.className = "obstacle";
            else {
                ob.className = "questionBox";
                ob.textContent = "?";
            }
            game.appendChild(ob);
        }, Math.max(1800 - level * 100, 1000));
    }

    function checkCollisions() {
        if (isPaused) return;
        const pr = player.getBoundingClientRect();
        document.querySelectorAll(".obstacle, .questionBox").forEach(ob => {
            const or = ob.getBoundingClientRect();
            if (
                pr.right > or.left &&
                pr.left < or.right &&
                pr.bottom > or.top &&
                pr.top < or.bottom
            ) {
                if (ob.classList.contains("questionBox")) {
                    const bonus = Math.random() < 0.5 ? -5 : 5;
                    time += bonus;
                    timeDisplay.textContent = time;
                    floatingMessage.textContent = bonus > 0 ? "Zaman yavaşladı!" : "Zaman hızlandı!";
                    floatingMessage.style.display = "block";
                    setTimeout(() => floatingMessage.style.display = "none", 1000);
                } else {
                    if (!isJumping) loseLifeOrRestart();
                }
                ob.remove();
            }
        });
    }

    function removeAll(sel) {
        document.querySelectorAll(sel).forEach(e => e.remove());
    }

    function showMessage(txt) {
        messageText.textContent = txt;
        overlay.classList.add("active");
        if (!txt.includes("bitti") && !txt.includes("can") && !txt.includes("Seviye")) {
            setTimeout(() => overlay.classList.remove("active"), 1500);
        }
    }
</script>

</body>
</html>
